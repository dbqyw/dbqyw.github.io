<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  
  
  <title>Web-File1 | qinyiwen</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
  <meta name="description" content="文件上传搭建靶场 Vulhub开靶场 123456789101112进入tomcat所在目录完整路径&#x2F;home&#x2F;fuzz&#x2F;vulhub&#x2F;tomcat&#x2F;tomcat8cd vulhub&#x2F;tomcat&#x2F;tomcat8建立容器docker-compose build开启漏洞环境docker-compose up -d出现绿色的done就是创建好了查看本机ipifconfig然后访问 http:&#x2F;&#x2F;you">
<meta property="og:type" content="article">
<meta property="og:title" content="Web-File1">
<meta property="og:url" content="http://example.com/2024/02/06/Web-File1/index.html">
<meta property="og:site_name" content="qinyiwen">
<meta property="og:description" content="文件上传搭建靶场 Vulhub开靶场 123456789101112进入tomcat所在目录完整路径&#x2F;home&#x2F;fuzz&#x2F;vulhub&#x2F;tomcat&#x2F;tomcat8cd vulhub&#x2F;tomcat&#x2F;tomcat8建立容器docker-compose build开启漏洞环境docker-compose up -d出现绿色的done就是创建好了查看本机ipifconfig然后访问 http:&#x2F;&#x2F;you">
<meta property="og:locale" content="en_US">
<meta property="og:image" content="https://github.com/dbqyw/qyw.github.io/assets/130265921/388b9289-db0f-431e-8811-231a7fa3a35c">
<meta property="og:image" content="https://github.com/dbqyw/qyw.github.io/assets/130265921/e49f589e-be44-43b5-b6c9-f896c2524426">
<meta property="og:image" content="https://github.com/dbqyw/qyw.github.io/assets/130265921/d72bda3d-d4f6-408d-8e32-9d96764841a5">
<meta property="og:image" content="https://github.com/dbqyw/qyw.github.io/assets/130265921/d5773950-aba3-4d69-a0d9-9c2fe6191a33">
<meta property="og:image" content="https://github.com/dbqyw/qyw.github.io/assets/130265921/8b9a3900-f491-4db5-93ce-7f7b44e9b7a6">
<meta property="og:image" content="https://github.com/dbqyw/qyw.github.io/assets/130265921/5051e49c-61ef-4826-9d5e-7cf5f8a80d93">
<meta property="og:image" content="https://github.com/dbqyw/qyw.github.io/assets/130265921/60a1de1b-9b4e-43d7-a5fd-ee5509f92155">
<meta property="og:image" content="https://github.com/dbqyw/qyw.github.io/assets/130265921/db0568d7-6c26-4c82-9143-76b47e48f6c1">
<meta property="og:image" content="https://github.com/dbqyw/qyw.github.io/assets/130265921/257b7d7f-ab0b-40ff-8b31-f6fd24c64273">
<meta property="og:image" content="https://github.com/dbqyw/qyw.github.io/assets/130265921/ad1fc581-4537-4c03-ac3f-bd0b85cb88e2">
<meta property="og:image" content="https://github.com/dbqyw/qyw.github.io/assets/130265921/e2bff410-6c2e-406d-a06b-ae6b6d83e92b">
<meta property="og:image" content="https://github.com/dbqyw/qyw.github.io/assets/130265921/c12f4d12-96db-41d7-8f3a-6e9c6d95deb0">
<meta property="og:image" content="https://github.com/dbqyw/qyw.github.io/assets/130265921/52dea5e6-0636-44ab-a307-104363826373">
<meta property="og:image" content="https://github.com/dbqyw/qyw.github.io/assets/130265921/3cac98aa-ef81-4468-a8ef-e0792d7a8c6d">
<meta property="og:image" content="https://github.com/dbqyw/qyw.github.io/assets/130265921/455b5f6b-955a-4acc-98f4-1e4766489658">
<meta property="og:image" content="https://github.com/dbqyw/qyw.github.io/assets/130265921/6d2c4b89-6449-40f7-b266-2fb166362b62">
<meta property="og:image" content="https://github.com/dbqyw/qyw.github.io/assets/130265921/d91e8710-36d0-45ea-b5af-941f2b401a04">
<meta property="og:image" content="https://github.com/dbqyw/qyw.github.io/assets/130265921/9ca56033-b394-40c2-8378-bcc65f53e15b">
<meta property="og:image" content="https://github.com/dbqyw/qyw.github.io/assets/130265921/9166d150-0624-44fd-b1ef-9fea0ea3dfef">
<meta property="article:published_time" content="2024-02-06T11:55:39.000Z">
<meta property="article:modified_time" content="2024-02-06T06:46:30.562Z">
<meta property="article:author" content="John Doe">
<meta property="article:tag" content="Web安全">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://github.com/dbqyw/qyw.github.io/assets/130265921/388b9289-db0f-431e-8811-231a7fa3a35c">
  
    <link rel="alternate" href="/atom.xml" title="qinyiwen" type="application/atom+xml">
  
  
    <link rel="shortcut icon" href="/favicon.png">
  
  
    
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/typeface-source-code-pro@0.0.71/index.min.css">

  
  
<link rel="stylesheet" href="/css/style.css">

  
    
<link rel="stylesheet" href="/fancybox/jquery.fancybox.min.css">

  
  
<meta name="generator" content="Hexo 6.3.0"></head>

<body>
  <div id="container">
    <div id="wrap">
      <header id="header">
  <div id="banner"></div>
  <div id="header-outer" class="outer">
    <div id="header-title" class="inner">
      <h1 id="logo-wrap">
        <a href="/" id="logo">qinyiwen</a>
      </h1>
      
    </div>
    <div id="header-inner" class="inner">
      <nav id="main-nav">
        <a id="main-nav-toggle" class="nav-icon"><span class="fa fa-bars"></span></a>
        
          <a class="main-nav-link" href="/">Home</a>
        
          <a class="main-nav-link" href="/archives">Archives</a>
        
      </nav>
      <nav id="sub-nav">
        
        
          <a class="nav-icon" href="/atom.xml" title="RSS Feed"><span class="fa fa-rss"></span></a>
        
        <a class="nav-icon nav-search-btn" title="Search"><span class="fa fa-search"></span></a>
      </nav>
      <div id="search-form-wrap">
        <form action="//google.com/search" method="get" accept-charset="UTF-8" class="search-form"><input type="search" name="q" class="search-form-input" placeholder="Search"><button type="submit" class="search-form-submit">&#xF002;</button><input type="hidden" name="sitesearch" value="http://example.com"></form>
      </div>
    </div>
  </div>
</header>

      <div class="outer">
        <section id="main"><article id="post-Web-File1" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="/2024/02/06/Web-File1/" class="article-date">
  <time class="dt-published" datetime="2024-02-06T11:55:39.000Z" itemprop="datePublished">2024-02-06</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 class="p-name article-title" itemprop="headline name">
      Web-File1
    </h1>
  

      </header>
    
    <div class="e-content article-entry" itemprop="articleBody">
      
        <h4 id="文件上传"><a href="#文件上传" class="headerlink" title="文件上传"></a>文件上传</h4><h5 id="搭建靶场-Vulhub"><a href="#搭建靶场-Vulhub" class="headerlink" title="搭建靶场 Vulhub"></a>搭建靶场 Vulhub</h5><p>开靶场</p>
<figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">进入tomcat所在目录</span><br><span class="line">完整路径/home/fuzz/vulhub/tomcat/tomcat8</span><br><span class="line">cd vulhub/tomcat/tomcat8</span><br><span class="line">建立容器</span><br><span class="line">docker-compose build</span><br><span class="line">开启漏洞环境</span><br><span class="line">docker-compose up -d</span><br><span class="line">出现绿色的done就是创建好了</span><br><span class="line">查看本机ip</span><br><span class="line">ifconfig</span><br><span class="line">然后访问 </span><br><span class="line">http://your-ip:8080/manager/html</span><br></pre></td></tr></table></figure>

<p>关靶场</p>
<figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">在tomcat8目录下将靶场关掉</span><br><span class="line">docker-compose down</span><br></pre></td></tr></table></figure>

<h5 id="相关知识"><a href="#相关知识" class="headerlink" title="相关知识"></a>相关知识</h5><p>思路，要知道是那种类型的漏洞，如果不知道，就按照常规处理</p>
<p><img src="https://github.com/dbqyw/qyw.github.io/assets/130265921/388b9289-db0f-431e-8811-231a7fa3a35c" alt="image"></p>
<p>1、什么是文件上传漏洞？</p>
<p>只要有文件上传的地方，就有可能存在文件上传漏洞，要判断文件上传部分的代码是否写得完整，安全，要是存在疏忽，就有文件上传漏洞存在的可能</p>
<p>2、文件上传漏洞有哪些危害？</p>
<p>可以上传后门文件webshell，获取到当前网站权限，高危漏洞</p>
<p>3、文件上传漏洞如何查找及判断？</p>
<p>查找</p>
<p>①黑盒查找，对方的源码我们不知道，需要自己判断，可以通过扫描目录、敏感文件，有的字典中会有上传地址，通过扫描获取上传地址，或者在网站上给出的相关应用，比如说备案中心，一般可以上传图像</p>
<p>②白盒查找，有对方的源代码，可以分析源代码查找有无文件上传功能，文件上传地址</p>
<p>主要方法是扫描，寻找上传点</p>
<p>4、文件上传漏洞有哪些需要注意的地方？</p>
<p>要对文件上传的类型进行区分，比如说是利用编辑器，就搜索这个编辑器的相关漏洞，然后利用漏洞上传</p>
<p>文件上传常见验证：</p>
<p>后缀名，类型，文件头等</p>
<p>后缀名：黑名单，白名单</p>
<p>文件类型：MIME信息</p>
<p>文件头：内容头信息</p>
<h4 id="文件上传之过滤方式"><a href="#文件上传之过滤方式" class="headerlink" title="文件上传之过滤方式"></a>文件上传之过滤方式</h4><h5 id="upload靶场"><a href="#upload靶场" class="headerlink" title="upload靶场"></a>upload靶场</h5><h5 id="相关函数"><a href="#相关函数" class="headerlink" title="相关函数"></a>相关函数</h5><p><a target="_blank" rel="noopener" href="https://blog.csdn.net/aaron_miller/article/details/106143006">upload-labs靶场通关（文件上传漏洞靶场）_風月长情的博客-CSDN博客</a></p>
<p><strong>move_uploaded_file(file,newloc)</strong></p>
<ul>
<li>将上传的文件移动到新位置，通过HTTP POST上传文件，如果目标文件已存在，则会被覆盖</li>
<li>file：要移动的文件</li>
<li>newloc：规定文件的位置</li>
</ul>
<p><strong>unlink(file)</strong> </p>
<p>删除文件</p>
<p><strong>in_array(search,array)</strong></p>
<p>搜索数组中是否存在指定的值</p>
<p>一句话木马</p>
<figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">&lt;?php phpinfo();?&gt;</span><br><span class="line">&lt;?php eval($_POST[a];?&gt;</span><br></pre></td></tr></table></figure>

<h5 id="Pass-01（前端JS绕过-x2F-客户端校验绕过）"><a href="#Pass-01（前端JS绕过-x2F-客户端校验绕过）" class="headerlink" title="Pass-01（前端JS绕过&#x2F;客户端校验绕过）"></a>Pass-01（前端JS绕过&#x2F;客户端校验绕过）</h5><p>有的网页采用js前端验证，可以在浏览器把js禁用，绕过验证，但是如果网站需要其它js代码才能正常运行，就不能采用这种方法</p>
<p>这道题是在前端使用了js对不合法图片进行检查</p>
<p>方法1</p>
<p>把网页源代码下载下来，删除js验证部分的代码，然后在图片上传的部分添加action，告诉它提交给谁</p>
<p>查看抓包信息，得到提交地址</p>
<p><img src="https://github.com/dbqyw/qyw.github.io/assets/130265921/e49f589e-be44-43b5-b6c9-f896c2524426" alt="image"></p>
<p>编辑代码，并且删除js验证部分的代码，再运行，就可以提交成功</p>
<p><img src="https://github.com/dbqyw/qyw.github.io/assets/130265921/d72bda3d-d4f6-408d-8e32-9d96764841a5" alt="image"></p>
<p>如果页面没有PHP代码来上传数据，只用JS来上传，就会抓不到包</p>
<p>方法2</p>
<p>在上传前，删除源码中的onsubmit&#x3D;”return checkFile()”</p>
<p>方法3</p>
<p>先将php文件后缀改为png，抓包，如何修改后缀名位.php在上传就可以上传成功</p>
<h5 id="Pass-02（后端验证文件类型–MIME校验）"><a href="#Pass-02（后端验证文件类型–MIME校验）" class="headerlink" title="Pass-02（后端验证文件类型–MIME校验）"></a>Pass-02（后端验证文件类型–MIME校验）</h5><p>点击右上角查看源码</p>
<p>源代码对图片类型进行了分析</p>
<p>方法1</p>
<p>上传一个图片文件，抓包记录它的MIME类型</p>
<p>上传一句话木马，抓包修改文件的MIME类型为刚才记录的 Content-Type</p>
<p>然后点击Forward提交，上传成功</p>
<p>方法2</p>
<p>修改文件后缀为图像文件，抓包修改文件名后缀</p>
<p><a target="_blank" rel="noopener" href="https://cn-sec.com/archives/68414.html">finecms前台任意文件上传漏洞 | CN-SEC 中文网</a></p>
<h4 id="刷题"><a href="#刷题" class="headerlink" title="刷题"></a>刷题</h4><h5 id="13、Upload"><a href="#13、Upload" class="headerlink" title="13、Upload"></a>13、Upload</h5><p>创建一个木马文件</p>
<p>可绕过的后缀名检测：<code>php,php3,php4,php5,phtml.pht</code></p>
<p><img src="https://github.com/dbqyw/qyw.github.io/assets/130265921/d5773950-aba3-4d69-a0d9-9c2fe6191a33" alt="image"></p>
<p>上传该文件，显示Not image!</p>
<p><img src="https://github.com/dbqyw/qyw.github.io/assets/130265921/8b9a3900-f491-4db5-93ce-7f7b44e9b7a6" alt="image"></p>
<p><img src="https://github.com/dbqyw/qyw.github.io/assets/130265921/5051e49c-61ef-4826-9d5e-7cf5f8a80d93" alt="image"></p>
<p>抓包，修改<code>Content-Type</code>的内容为 <code>image/jpeg</code>，send，查看文件名后缀应为.phtml</p>
<p><img src="https://github.com/dbqyw/qyw.github.io/assets/130265921/60a1de1b-9b4e-43d7-a5fd-ee5509f92155" alt="image"></p>
<p>使用蚁剑</p>
<p>URL地址为：<code>/upload/a.phtml</code></p>
<p>连接密码为：<code>a</code></p>
<p>测试连接，连接成功后添加</p>
<p><img src="https://github.com/dbqyw/qyw.github.io/assets/130265921/db0568d7-6c26-4c82-9143-76b47e48f6c1" alt="image"></p>
<p><img src="https://github.com/dbqyw/qyw.github.io/assets/130265921/257b7d7f-ab0b-40ff-8b31-f6fd24c64273" alt="image"></p>
<p>右键单击，文件管理，查看根目录，找到flag</p>
<p><img src="https://github.com/dbqyw/qyw.github.io/assets/130265921/ad1fc581-4537-4c03-ac3f-bd0b85cb88e2" alt="image"></p>
<p>双击查看flag</p>
<p><img src="https://github.com/dbqyw/qyw.github.io/assets/130265921/e2bff410-6c2e-406d-a06b-ae6b6d83e92b" alt="image"></p>
<figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">flag&#123;34c3fd89-3b0b-450b-9953-287122b67247&#125;</span><br></pre></td></tr></table></figure>

<h5 id="14、Upload"><a href="#14、Upload" class="headerlink" title="14、Upload"></a>14、Upload</h5><p>上传一句话木马<code>&lt;?php eval($_POST[a]);?&gt;</code>，修改后缀名为<code>.jpg</code></p>
<p><img src="https://github.com/dbqyw/qyw.github.io/assets/130265921/c12f4d12-96db-41d7-8f3a-6e9c6d95deb0" alt="image"></p>
<p>抓包，显示上传成功</p>
<p><img src="https://github.com/dbqyw/qyw.github.io/assets/130265921/52dea5e6-0636-44ab-a307-104363826373" alt="image"></p>
<p>使用蚁剑连接，URL地址为：<code>http://458e3dd3-d7c3-41c5-b4cd-06727f565048.node4.buuoj.cn:81/./uplo4d/394659692a460258b45a99f1424ea357.jpg</code></p>
<p>连接密码为：<code>a</code></p>
<p>尝试一下，测试连接显示返回数据为空</p>
<p><img src="https://github.com/dbqyw/qyw.github.io/assets/130265921/3cac98aa-ef81-4468-a8ef-e0792d7a8c6d" alt="image"></p>
<p>尝试修改后缀名为.phtml</p>
<p><img src="https://github.com/dbqyw/qyw.github.io/assets/130265921/455b5f6b-955a-4acc-98f4-1e4766489658" alt="image"></p>
<p>使用蚁剑连接，URL地址为：<code>http://458e3dd3-d7c3-41c5-b4cd-06727f565048.node4.buuoj.cn:81/./uplo4d/71056c0c9cb12f2b7d720156da9eabf1.phtml</code></p>
<p>连接密码为：<code>a</code></p>
<p>测试连接，连接成功 后添加</p>
<p><img src="https://github.com/dbqyw/qyw.github.io/assets/130265921/6d2c4b89-6449-40f7-b266-2fb166362b62" alt="image"></p>
<p><img src="https://github.com/dbqyw/qyw.github.io/assets/130265921/d91e8710-36d0-45ea-b5af-941f2b401a04" alt="image"></p>
<p>右键单击，文件管理</p>
<p>在根目录中找到flag</p>
<p><img src="https://github.com/dbqyw/qyw.github.io/assets/130265921/9ca56033-b394-40c2-8378-bcc65f53e15b" alt="image"></p>
<p>双击查看flag</p>
<p><img src="https://github.com/dbqyw/qyw.github.io/assets/130265921/9166d150-0624-44fd-b1ef-9fea0ea3dfef" alt="image"></p>
<figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">flag&#123;8337ba06-02fe-47b4-8563-e341d08b19fe&#125;</span><br></pre></td></tr></table></figure>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://example.com/2024/02/06/Web-File1/" data-id="clsa003oc0000uovf5tsjeevx" data-title="Web-File1" class="article-share-link"><span class="fa fa-share">Share</span></a>
      
      
      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Web%E5%AE%89%E5%85%A8/" rel="tag">Web安全</a></li></ul>

    </footer>
  </div>
  
    
<nav id="article-nav">
  
    <a href="/2024/02/07/Web-File2/" id="article-nav-newer" class="article-nav-link-wrap">
      <strong class="article-nav-caption">Newer</strong>
      <div class="article-nav-title">
        
          Web-File2
        
      </div>
    </a>
  
  
    <a href="/2024/02/03/Paper-Code%20Vulnerability%20Detection%20via%20Signal-Aware%20AI/" id="article-nav-older" class="article-nav-link-wrap">
      <strong class="article-nav-caption">Older</strong>
      <div class="article-nav-title">RESOLVERFUZZ</div>
    </a>
  
</nav>

  
</article>


</section>
        
          <aside id="sidebar">
  
    

  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Tags</h3>
    <div class="widget">
      <ul class="tag-list" itemprop="keywords"><li class="tag-list-item"><a class="tag-list-link" href="/tags/CTF/" rel="tag">CTF</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Fuzzing/" rel="tag">Fuzzing</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Web%E5%AE%89%E5%85%A8/" rel="tag">Web安全</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/learn/" rel="tag">learn</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/security/" rel="tag">security</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E8%AE%BA%E6%96%87%E7%BB%86%E8%AF%BB/" rel="tag">论文细读</a></li></ul>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Tag Cloud</h3>
    <div class="widget tagcloud">
      <a href="/tags/CTF/" style="font-size: 16.67px;">CTF</a> <a href="/tags/Fuzzing/" style="font-size: 16.67px;">Fuzzing</a> <a href="/tags/Web%E5%AE%89%E5%85%A8/" style="font-size: 13.33px;">Web安全</a> <a href="/tags/learn/" style="font-size: 16.67px;">learn</a> <a href="/tags/security/" style="font-size: 10px;">security</a> <a href="/tags/%E8%AE%BA%E6%96%87%E7%BB%86%E8%AF%BB/" style="font-size: 20px;">论文细读</a>
    </div>
  </div>

  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Archives</h3>
    <div class="widget">
      <ul class="archive-list"><li class="archive-list-item"><a class="archive-list-link" href="/archives/2024/02/">February 2024</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2024/01/">January 2024</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2023/08/">August 2023</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2023/07/">July 2023</a></li></ul>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Recent Posts</h3>
    <div class="widget">
      <ul>
        
          <li>
            <a href="/2024/02/21/20240221/">20240221</a>
          </li>
        
          <li>
            <a href="/2024/02/20/20240220/">20240220</a>
          </li>
        
          <li>
            <a href="/2024/02/18/20240218/">20240218</a>
          </li>
        
          <li>
            <a href="/2024/02/16/Paper-SQIRL/">SQIRL__</a>
          </li>
        
          <li>
            <a href="/2024/02/15/20240215/">20240215</a>
          </li>
        
      </ul>
    </div>
  </div>

  
</aside>
        
      </div>
      <footer id="footer">
  
  <div class="outer">
    <div id="footer-info" class="inner">
      
      &copy; 2024 John Doe<br>
      Powered by <a href="https://hexo.io/" target="_blank">Hexo</a>
    </div>
  </div>
</footer>

    </div>
    <nav id="mobile-nav">
  
    <a href="/" class="mobile-nav-link">Home</a>
  
    <a href="/archives" class="mobile-nav-link">Archives</a>
  
</nav>
    


<script src="/js/jquery-3.6.4.min.js"></script>



  
<script src="/fancybox/jquery.fancybox.min.js"></script>




<script src="/js/script.js"></script>





  </div>
</body>
</html>